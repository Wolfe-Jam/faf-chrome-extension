var o=(t=>(t.PLATFORM_DETECTION_TIMEOUT="FAF_1001",t.PLATFORM_DETECTION_FAILED="FAF_1002",t.PLATFORM_NOT_SUPPORTED="FAF_1003",t.PLATFORM_DOM_ACCESS_DENIED="FAF_1004",t.EXTRACTION_TIMEOUT="FAF_1101",t.EXTRACTION_FAILED="FAF_1102",t.EXTRACTION_INVALID_DATA="FAF_1103",t.EXTRACTION_PERMISSION_DENIED="FAF_1104",t.EXTRACTION_RATE_LIMITED="FAF_1105",t.CHROME_TAB_ACCESS_DENIED="FAF_1201",t.CHROME_STORAGE_QUOTA_EXCEEDED="FAF_1202",t.CHROME_MESSAGING_FAILED="FAF_1203",t.CHROME_PERMISSIONS_MISSING="FAF_1204",t.CHROME_RUNTIME_ERROR="FAF_1205",t.CHROME_TAB_NOT_FOUND="FAF_1206",t.CHROME_API_UNAVAILABLE="FAF_1207",t.CHROME_MESSAGE_FAILED="FAF_1208",t.CHROME_SCRIPTING_FAILED="FAF_1209",t.CHROME_STORAGE_ERROR="FAF_1210",t.SERVICE_WORKER_INIT_FAILED="FAF_1301",t.SERVICE_WORKER_MESSAGE_FAILED="FAF_1302",t.SERVICE_WORKER_MEMORY_PRESSURE="FAF_1303",t.SERVICE_WORKER_TIMEOUT="FAF_1304",t.POPUP_LOAD_FAILED="FAF_1401",t.POPUP_ACTION_FAILED="FAF_1402",t.POPUP_DATA_CORRUPT="FAF_1403",t.CLIPBOARD_PERMISSION_DENIED="FAF_1501",t.CLIPBOARD_WRITE_FAILED="FAF_1502",t.CLIPBOARD_DATA_TOO_LARGE="FAF_1503",t.NETWORK_REQUEST_FAILED="FAF_1601",t.NETWORK_TIMEOUT="FAF_1602",t.NETWORK_RATE_LIMITED="FAF_1603",t.CONTENT_SCRIPT_INJECTION_FAILED="FAF_1701",t.CONTENT_SCRIPT_DOM_BLOCKED="FAF_1702",t.CONTENT_SCRIPT_CSP_VIOLATION="FAF_1703",t.UNKNOWN_ERROR="FAF_1901",t.SYSTEM_OVERLOAD="FAF_1902",t.CONFIGURATION_ERROR="FAF_1903",t.DEPENDENCY_ERROR="FAF_1904",t))(o||{}),c=(t=>(t.LOW="low",t.MEDIUM="medium",t.HIGH="high",t.CRITICAL="critical",t))(c||{}),m=(t=>(t.RETRY="retry",t.FALLBACK="fallback",t.GRACEFUL_DEGRADATION="degrade",t.USER_ACTION_REQUIRED="user",t.RESTART_REQUIRED="restart",t.NO_RECOVERY="none",t))(m||{});class a extends Error{code;severity;userMessage;technicalDetails;recoveryStrategy;recoveryActions;context;timestamp;constructor(e,r,n={}){super(r,{cause:n.cause}),this.name="FAFError",this.code=e,this.timestamp=Date.now();const s=l.getErrorInfo(e);this.severity=s.severity,this.recoveryStrategy=s.recoveryStrategy,this.recoveryActions=s.recoveryActions,this.userMessage=n.userMessage||s.userMessage,this.technicalDetails=n.technicalDetails,this.context={timestamp:this.timestamp,platform:n.context?.platform,url:n.context?.url||(typeof window<"u"?window.location.href:void 0),userAgent:n.context?.userAgent||(typeof navigator<"u"?navigator.userAgent:void 0),sessionId:n.context?.sessionId},this.trackError()}static fromUnknown(e,r){if(e instanceof a)return e;if(e instanceof Error){let s="FAF_1901";return e.message.includes("timeout")?s="FAF_1101":e.message.includes("permission")?s="FAF_1204":e.message.includes("DOM")||e.message.includes("document")?s="FAF_1004":e.message.includes("quota")&&(s="FAF_1202"),new a(s,e.message,{cause:e,technicalDetails:e.stack,context:r})}const n=typeof e=="string"?e:String(e);return new a("FAF_1901",n,{context:r})}isRecoverable(){return this.recoveryStrategy!=="none"}requiresUserAction(){return this.recoveryStrategy==="user"}getDisplayInfo(){return{title:this.getErrorTitle(),message:this.userMessage,actions:this.recoveryActions,severity:this.severity,canRetry:this.recoveryStrategy==="retry"}}toJSON(){return{code:this.code,severity:this.severity,message:this.message,userMessage:this.userMessage,technicalDetails:this.technicalDetails,recoveryStrategy:this.recoveryStrategy,recoveryActions:this.recoveryActions,context:this.context,timestamp:this.timestamp,stack:this.stack}}getErrorTitle(){return{low:"Minor Issue",medium:"Issue Detected",high:"Extraction Problem",critical:"Critical Error"}[this.severity]}trackError(){try{console.warn(`[FAF Error ${this.code}] ${this.severity}: ${this.message}`)}catch{}}}class l{static errorDefinitions=new Map([["FAF_1001",{code:"FAF_1001",severity:"medium",message:"Platform detection timed out",userMessage:"Unable to detect the current platform quickly enough. The page may be loading slowly.",recoveryStrategy:"retry",recoveryActions:["Wait for page to load completely","Refresh the page","Try extraction again"]}],["FAF_1003",{code:"FAF_1003",severity:"medium",message:"Platform is not supported",userMessage:"This website is not currently supported by FAF. We support GitHub, Monaco Editor, CodeMirror, and other development platforms.",recoveryStrategy:"degrade",recoveryActions:["Try on a supported platform","Copy code manually","Request platform support"]}],["FAF_1004",{code:"FAF_1004",severity:"high",message:"DOM access denied",userMessage:"Cannot access page content due to security restrictions. This may be due to strict Content Security Policy.",recoveryStrategy:"user",recoveryActions:["Refresh the page","Check browser security settings","Try on a different page"]}],["FAF_1101",{code:"FAF_1101",severity:"medium",message:"Context extraction timed out",userMessage:"Extraction took longer than expected. The page may have complex content or be loading slowly.",recoveryStrategy:"retry",recoveryActions:["Wait a moment and try again","Refresh the page","Check internet connection"]}],["FAF_1104",{code:"FAF_1104",severity:"high",message:"Permission denied for extraction",userMessage:"FAF does not have permission to access this page. Please check extension permissions.",recoveryStrategy:"user",recoveryActions:["Check extension permissions in browser settings","Reload the extension","Refresh the page"]}],["FAF_1201",{code:"FAF_1201",severity:"high",message:"Chrome tab access denied",userMessage:"Cannot access the current tab. Please ensure FAF has the necessary permissions.",recoveryStrategy:"user",recoveryActions:["Grant tab permissions to FAF","Reload the extension","Check browser security settings"]}],["FAF_1202",{code:"FAF_1202",severity:"medium",message:"Chrome storage quota exceeded",userMessage:"Extension storage is full. Some data may not be saved.",recoveryStrategy:"fallback",recoveryActions:["Clear extension data","Restart browser","Continue without saving preferences"]}],["FAF_1204",{code:"FAF_1204",severity:"critical",message:"Required Chrome permissions missing",userMessage:"FAF is missing required permissions to function properly.",recoveryStrategy:"user",recoveryActions:["Go to chrome://extensions/","Find FAF extension","Grant required permissions"]}],["FAF_1206",{code:"FAF_1206",severity:"medium",message:"No active tab found",userMessage:"No active tab detected. Please open a supported page.",recoveryStrategy:"user",recoveryActions:["Open a supported website","Refresh the current page","Try a different tab"]}],["FAF_1207",{code:"FAF_1207",severity:"high",message:"Chrome API unavailable",userMessage:"Chrome extension APIs are not available.",recoveryStrategy:"restart",recoveryActions:["Restart browser","Check Chrome version","Reinstall extension"]}],["FAF_1208",{code:"FAF_1208",severity:"medium",message:"Chrome message failed",userMessage:"Failed to communicate with the page. Please try again.",recoveryStrategy:"retry",recoveryActions:["Try again","Refresh the page","Check page permissions"]}],["FAF_1209",{code:"FAF_1209",severity:"high",message:"Script injection failed",userMessage:"Unable to inject required scripts into the page.",recoveryStrategy:"fallback",recoveryActions:["Refresh the page","Try a different page","Check site permissions"]}],["FAF_1210",{code:"FAF_1210",severity:"medium",message:"Chrome storage error",userMessage:"Unable to save data. Some features may not persist.",recoveryStrategy:"degrade",recoveryActions:["Continue without saving","Clear extension data","Restart browser"]}],["FAF_1301",{code:"FAF_1301",severity:"critical",message:"Service worker initialization failed",userMessage:"Extension background service failed to start. Please restart the browser.",recoveryStrategy:"restart",recoveryActions:["Restart browser","Reload extension","Check for browser updates"]}],["FAF_1303",{code:"FAF_1303",severity:"medium",message:"Service worker under memory pressure",userMessage:"Extension is using high memory. Performance may be affected.",recoveryStrategy:"degrade",recoveryActions:["Close unused tabs","Restart browser","Limit concurrent extractions"]}],["FAF_1501",{code:"FAF_1501",severity:"medium",message:"Clipboard permission denied",userMessage:"Cannot copy to clipboard automatically. You can copy the content manually.",recoveryStrategy:"fallback",recoveryActions:["Grant clipboard permission","Copy content manually","Use Ctrl+C to copy"]}],["FAF_1503",{code:"FAF_1503",severity:"low",message:"Clipboard data too large",userMessage:"The extracted content is too large for clipboard. Consider extracting smaller sections.",recoveryStrategy:"degrade",recoveryActions:["Extract smaller code sections","Copy parts manually","Save to file instead"]}],["FAF_1703",{code:"FAF_1703",severity:"high",message:"Content Security Policy violation",userMessage:"Page security settings prevent FAF from working. This is common on some secure sites.",recoveryStrategy:"degrade",recoveryActions:["Try on a different page","Use manual copy instead","Contact site administrator"]}],["FAF_1901",{code:"FAF_1901",severity:"medium",message:"An unexpected error occurred",userMessage:"Something unexpected happened. Please try again or restart the browser.",recoveryStrategy:"retry",recoveryActions:["Try the action again","Refresh the page","Restart browser if issues persist"]}]]);static getErrorInfo(e){const r=this.errorDefinitions.get(e);return r||{code:e,severity:"medium",message:"Unknown error",userMessage:"An unknown error occurred. Please try again.",recoveryStrategy:"retry",recoveryActions:["Try again","Restart extension"]}}static getAllErrorCodes(){return Array.from(this.errorDefinitions.keys())}}var u={};class h{config;sessionId;breadcrumbs=[];performanceBuffer=[];userId;constructor(e){this.config=e,this.sessionId=this.generateSessionId(),this.initializeErrorHandling(),this.initializePerformanceTracking(),this.startPerformanceReporting()}generateSessionId(){return`session_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}initializeErrorHandling(){this.config.enableErrorReporting&&(window.addEventListener("error",e=>{this.reportError(new Error(e.message),{action:"global_error",url:e.filename,line:e.lineno,column:e.colno})}),window.addEventListener("unhandledrejection",e=>{this.reportError(new Error(`Unhandled Promise Rejection: ${e.reason}`),{action:"unhandled_promise_rejection"})}))}initializePerformanceTracking(){this.config.enablePerformanceTracking&&(typeof performance<"u"&&performance.timing&&window.addEventListener("load",()=>{setTimeout(()=>{this.trackPerformanceMetrics()},1e3)}),this.trackExtensionMetrics())}trackExtensionMetrics(){if(chrome?.runtime){const e=performance.now();chrome.runtime.connect({name:"telemetry"});const r=performance.now()-e;this.recordMetric({name:"service_worker_connection_time",value:r,unit:"ms",timestamp:Date.now()})}if(document.readyState==="loading"){const e=performance.now();document.addEventListener("DOMContentLoaded",()=>{const r=performance.now()-e;this.recordMetric({name:"content_script_injection_time",value:r,unit:"ms",timestamp:Date.now()})})}}trackPerformanceMetrics(){const e=performance.timing,r=performance.navigation;if([{name:"dom_content_loaded",value:e.domContentLoadedEventEnd-e.navigationStart,unit:"ms"},{name:"page_load_complete",value:e.loadEventEnd-e.navigationStart,unit:"ms"},{name:"dns_lookup_time",value:e.domainLookupEnd-e.domainLookupStart,unit:"ms"},{name:"tcp_connection_time",value:e.connectEnd-e.connectStart,unit:"ms"}].forEach(s=>{s.value>0&&this.recordMetric({...s,timestamp:Date.now(),metadata:{navigationType:r.type,redirectCount:r.redirectCount}})}),performance.memory){const s=performance.memory;this.recordMetric({name:"memory_used",value:s.usedJSHeapSize,unit:"bytes",timestamp:Date.now()}),this.recordMetric({name:"memory_limit",value:s.jsHeapSizeLimit,unit:"bytes",timestamp:Date.now()})}}startPerformanceReporting(){setInterval(()=>{this.performanceBuffer.length>0&&this.flushPerformanceMetrics()},3e4)}async recordMetric(e){if(this.config.enablePerformanceTracking&&!(Math.random()>this.config.sampleRate)){this.performanceBuffer.push(e);try{const n=(await chrome.storage.local.get("telemetry_metrics")).telemetry_metrics||[];n.push(e),n.length>100&&n.shift(),await chrome.storage.local.set({telemetry_metrics:n})}catch(r){console.warn("Failed to store telemetry metric:",r)}}}async reportError(e,r={}){if(!this.config.enableErrorReporting)return;const n={error:{name:e.name,message:e.message,stack:e.stack||""},context:{userAgent:navigator.userAgent,timestamp:Date.now(),sessionId:this.sessionId,userId:this.userId,extensionVersion:this.getExtensionVersion(),...r},stackTrace:e.stack||"",breadcrumbs:[...this.breadcrumbs]};try{const i=(await chrome.storage.local.get("telemetry_errors")).telemetry_errors||[];i.push(n),i.length>50&&i.shift(),await chrome.storage.local.set({telemetry_errors:i})}catch(s){console.warn("Failed to store error report:",s)}this.sendErrorReport(n)}async trackUserEvent(e,r={}){if(!this.config.enableUserAnalytics)return;const n={event:e,properties:{...r,extensionVersion:this.getExtensionVersion(),environment:this.config.environment},timestamp:Date.now(),sessionId:this.sessionId,userId:this.userId};try{const i=(await chrome.storage.local.get("telemetry_events")).telemetry_events||[];i.push(n),i.length>200&&i.shift(),await chrome.storage.local.set({telemetry_events:i})}catch(s){console.warn("Failed to store user event:",s)}this.sendUserEvent(n)}async trackExtraction(e,r={}){return this.trackUserEvent(`extraction_${e}`,r)}async track(e,r={}){return this.trackUserEvent(e,r)}addBreadcrumb(e){const r=`${new Date().toISOString()}: ${e}`;this.breadcrumbs.push(r),this.breadcrumbs.length>20&&this.breadcrumbs.shift()}setUserId(e){this.userId=e}async flushPerformanceMetrics(){if(this.performanceBuffer.length===0)return;const e=[...this.performanceBuffer];this.performanceBuffer=[];try{await this.sendBatch("metrics",e)}catch(r){console.warn("Failed to send performance metrics:",r),this.performanceBuffer.unshift(...e)}}async sendErrorReport(e){try{await this.sendBatch("errors",[e])}catch(r){console.warn("Failed to send error report:",r)}}async sendUserEvent(e){try{await this.sendBatch("events",[e])}catch(r){console.warn("Failed to send user event:",r)}}async sendBatch(e,r){if(!this.config.endpoint)return;const n={type:e,data:r,timestamp:Date.now(),sessionId:this.sessionId,userId:this.userId,environment:this.config.environment},s=await fetch(`${this.config.endpoint}/${e}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});if(!s.ok)throw new Error(`HTTP ${s.status}: ${s.statusText}`)}getExtensionVersion(){try{return chrome.runtime.getManifest().version}catch{return"unknown"}}startTimer(e){const r=performance.now();return()=>{const n=performance.now()-r;this.recordMetric({name:e,value:n,unit:"ms",timestamp:Date.now()})}}trackMemoryUsage(e){if(performance.memory){const r=performance.memory;this.recordMetric({name:"memory_usage_snapshot",value:r.usedJSHeapSize,unit:"bytes",timestamp:Date.now(),metadata:{context:e}})}}trackNetworkRequest(e,r,n,s){this.recordMetric({name:"network_request",value:n,unit:"ms",timestamp:Date.now(),metadata:{url:e.replace(/[?#].*/,""),method:r,status:s,success:s>=200&&s<400}})}}const g=()=>{const e={environment:"production",enableErrorReporting:!0,enablePerformanceTracking:!0,enableUserAnalytics:!0,sampleRate:.1,endpoint:u.TELEMETRY_ENDPOINT};return new h(e)},_=async(t,e)=>{const r=d.startTimer(t);try{const n=await e();return r(),n}catch(n){throw r(),n}},d=g();class y{static async getActive(){return new Promise((e,r)=>{try{chrome.tabs.query({active:!0,currentWindow:!0},n=>{if(chrome.runtime.lastError){r(new a(o.CHROME_RUNTIME_ERROR,chrome.runtime.lastError.message||"Unknown runtime error",{technicalDetails:"Chrome tabs API operation failed"}));return}const s=n[0];if(!s?.id||!s.url){r(new a(o.CHROME_TAB_NOT_FOUND,"No active tab found",{technicalDetails:"Chrome tabs API operation failed"}));return}e({id:s.id,url:s.url,title:s.title??"",active:s.active})})}catch(n){r(new a(o.CHROME_API_UNAVAILABLE,n instanceof Error?n.message:"Unknown tabs API error",{technicalDetails:"Chrome API operation failed"}))}})}static async sendMessage(e,r){return new Promise((n,s)=>{try{chrome.tabs.sendMessage(e,r,i=>{if(chrome.runtime.lastError){s(new a(o.CHROME_MESSAGE_FAILED,chrome.runtime.lastError.message||"Unknown runtime error",{technicalDetails:"Chrome API operation failed"}));return}n()})}catch(i){s(new a(o.CHROME_API_UNAVAILABLE,i instanceof Error?i.message:"Unknown messaging error",{technicalDetails:"Chrome API operation failed"}))}})}static async executeScript(e,r){return new Promise((n,s)=>{try{chrome.scripting.executeScript({target:{tabId:e},files:[...r]},()=>{if(chrome.runtime.lastError){s(new a(o.CHROME_SCRIPTING_FAILED,chrome.runtime.lastError.message||"Unknown runtime error",{technicalDetails:"Chrome API operation failed"}));return}n()})}catch(i){s(new a(o.CHROME_API_UNAVAILABLE,i instanceof Error?i.message:"Unknown scripting error",{technicalDetails:"Chrome API operation failed"}))}})}}class f{static async get(e){return new Promise((r,n)=>{try{chrome.storage.local.get([...e],s=>{if(chrome.runtime.lastError){n(new a(o.CHROME_STORAGE_ERROR,chrome.runtime.lastError.message||"Unknown storage error",{technicalDetails:"Chrome API operation failed"}));return}r(s)})}catch(s){n(new a(o.CHROME_API_UNAVAILABLE,s instanceof Error?s.message:"Unknown storage error",{technicalDetails:"Chrome API operation failed"}))}})}static async set(e){return new Promise((r,n)=>{try{chrome.storage.local.set(e,()=>{if(chrome.runtime.lastError){n(new a(o.CHROME_STORAGE_QUOTA_EXCEEDED,chrome.runtime.lastError.message||"Unknown storage error",{technicalDetails:"Chrome API operation failed"}));return}r()})}catch(s){n(new a(o.CHROME_API_UNAVAILABLE,s instanceof Error?s.message:"Unknown storage error",{technicalDetails:"Chrome API operation failed"}))}})}static async clear(){return new Promise((e,r)=>{try{chrome.storage.local.clear(()=>{if(chrome.runtime.lastError){r(new a(o.CHROME_STORAGE_ERROR,chrome.runtime.lastError.message||"Unknown storage error",{technicalDetails:"Chrome API operation failed"}));return}e()})}catch(n){r(new a(o.CHROME_API_UNAVAILABLE,n instanceof Error?n.message:"Unknown storage error",{technicalDetails:"Chrome API operation failed"}))}})}}class A{static sendMessage(e){try{chrome.runtime.sendMessage(e)}catch(r){throw new a(o.CHROME_RUNTIME_ERROR,r instanceof Error?r.message:"Unknown runtime error",{technicalDetails:"Chrome API operation failed"})}}static onMessage(e){chrome.runtime.onMessage.addListener(e)}static onInstalled(e){chrome.runtime.onInstalled.addListener(e)}}export{A as C,a as F,o as a,c as b,m as c,_ as d,y as e,f,d as t};
