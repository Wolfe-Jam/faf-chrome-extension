var FAFPopup=function(){"use strict";function P(){}function ee(t){return t()}function te(){return Object.create(null)}function j(t){t.forEach(ee)}function re(t){return typeof t=="function"}function Ae(t,e){return t!=t?e==e:t!==e||t&&typeof t=="object"||typeof t=="function"}function we(t){return Object.keys(t).length===0}function a(t,e){t.appendChild(e)}function T(t,e,r){t.insertBefore(e,r||null)}function F(t){t.parentNode&&t.parentNode.removeChild(t)}function Fe(t,e){for(let r=0;r<t.length;r+=1)t[r]&&t[r].d(e)}function d(t){return document.createElement(t)}function v(t){return document.createTextNode(t)}function y(){return v(" ")}function ne(t,e,r,n){return t.addEventListener(e,r,n),()=>t.removeEventListener(e,r,n)}function g(t,e,r){r==null?t.removeAttribute(e):t.getAttribute(e)!==r&&t.setAttribute(e,r)}function be(t){return Array.from(t.childNodes)}function S(t,e){e=""+e,t.data!==e&&(t.data=e)}function se(t,e,r,n){r==null?t.style.removeProperty(e):t.style.setProperty(e,r,"")}let B;function H(t){B=t}function Re(){if(!B)throw new Error("Function called outside component initialization");return B}function Te(t){Re().$$.on_mount.push(t)}const D=[],ie=[];let N=[];const oe=[],Ie=Promise.resolve();let z=!1;function Ce(){z||(z=!0,Ie.then(ae))}function q(t){N.push(t)}const K=new Set;let $=0;function ae(){if($!==0)return;const t=B;do{try{for(;$<D.length;){const e=D[$];$++,H(e),ke(e.$$)}}catch(e){throw D.length=0,$=0,e}for(H(null),D.length=0,$=0;ie.length;)ie.pop()();for(let e=0;e<N.length;e+=1){const r=N[e];K.has(r)||(K.add(r),r())}N.length=0}while(D.length);for(;oe.length;)oe.pop()();z=!1,K.clear(),H(t)}function ke(t){if(t.fragment!==null){t.update(),j(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(q)}}function Se(t){const e=[],r=[];N.forEach(n=>t.indexOf(n)===-1?e.push(n):r.push(n)),r.forEach(n=>n()),N=e}const Me=new Set;function Oe(t,e){t&&t.i&&(Me.delete(t),t.i(e))}function ce(t){return t?.length!==void 0?t:Array.from(t)}function xe(t,e,r){const{fragment:n,after_update:s}=t.$$;n&&n.m(e,r),q(()=>{const c=t.$$.on_mount.map(ee).filter(re);t.$$.on_destroy?t.$$.on_destroy.push(...c):j(c),t.$$.on_mount=[]}),s.forEach(q)}function Pe(t,e){const r=t.$$;r.fragment!==null&&(Se(r.after_update),j(r.on_destroy),r.fragment&&r.fragment.d(e),r.on_destroy=r.fragment=null,r.ctx=[])}function De(t,e){t.$$.dirty[0]===-1&&(D.push(t),Ce(),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function Ne(t,e,r,n,s,c,l=null,u=[-1]){const i=B;H(t);const o=t.$$={fragment:null,ctx:[],props:c,update:P,not_equal:s,bound:te(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(i?i.$$.context:[])),callbacks:te(),dirty:u,skip_bound:!1,root:e.target||i.$$.root};l&&l(o.root);let m=!1;if(o.ctx=r?r(t,e.props||{},(_,f,...k)=>{const b=k.length?k[0]:f;return o.ctx&&s(o.ctx[_],o.ctx[_]=b)&&(!o.skip_bound&&o.bound[_]&&o.bound[_](b),m&&De(t,_)),f}):[],o.update(),m=!0,j(o.before_update),o.fragment=n?n(o.ctx):!1,e.target){if(e.hydrate){const _=be(e.target);o.fragment&&o.fragment.l(_),_.forEach(F)}else o.fragment&&o.fragment.c();e.intro&&Oe(t.$$.fragment),xe(t,e.target,e.anchor),ae()}H(i)}class $e{$$=void 0;$$set=void 0;$destroy(){Pe(this,1),this.$destroy=P}$on(e,r){if(!re(r))return P;const n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(r),()=>{const s=n.indexOf(r);s!==-1&&n.splice(s,1)}}$set(e){this.$$set&&!we(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const Le="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(Le);var I=(t=>(t.PLATFORM_DETECTION_TIMEOUT="FAF_1001",t.PLATFORM_DETECTION_FAILED="FAF_1002",t.PLATFORM_NOT_SUPPORTED="FAF_1003",t.PLATFORM_DOM_ACCESS_DENIED="FAF_1004",t.EXTRACTION_TIMEOUT="FAF_1101",t.EXTRACTION_FAILED="FAF_1102",t.EXTRACTION_INVALID_DATA="FAF_1103",t.EXTRACTION_PERMISSION_DENIED="FAF_1104",t.EXTRACTION_RATE_LIMITED="FAF_1105",t.CHROME_TAB_ACCESS_DENIED="FAF_1201",t.CHROME_STORAGE_QUOTA_EXCEEDED="FAF_1202",t.CHROME_MESSAGING_FAILED="FAF_1203",t.CHROME_PERMISSIONS_MISSING="FAF_1204",t.CHROME_RUNTIME_ERROR="FAF_1205",t.CHROME_TAB_NOT_FOUND="FAF_1206",t.CHROME_API_UNAVAILABLE="FAF_1207",t.CHROME_MESSAGE_FAILED="FAF_1208",t.CHROME_SCRIPTING_FAILED="FAF_1209",t.CHROME_STORAGE_ERROR="FAF_1210",t.SERVICE_WORKER_INIT_FAILED="FAF_1301",t.SERVICE_WORKER_MESSAGE_FAILED="FAF_1302",t.SERVICE_WORKER_MEMORY_PRESSURE="FAF_1303",t.SERVICE_WORKER_TIMEOUT="FAF_1304",t.POPUP_LOAD_FAILED="FAF_1401",t.POPUP_ACTION_FAILED="FAF_1402",t.POPUP_DATA_CORRUPT="FAF_1403",t.CLIPBOARD_PERMISSION_DENIED="FAF_1501",t.CLIPBOARD_WRITE_FAILED="FAF_1502",t.CLIPBOARD_DATA_TOO_LARGE="FAF_1503",t.NETWORK_REQUEST_FAILED="FAF_1601",t.NETWORK_TIMEOUT="FAF_1602",t.NETWORK_RATE_LIMITED="FAF_1603",t.CONTENT_SCRIPT_INJECTION_FAILED="FAF_1701",t.CONTENT_SCRIPT_DOM_BLOCKED="FAF_1702",t.CONTENT_SCRIPT_CSP_VIOLATION="FAF_1703",t.UNKNOWN_ERROR="FAF_1901",t.SYSTEM_OVERLOAD="FAF_1902",t.CONFIGURATION_ERROR="FAF_1903",t.DEPENDENCY_ERROR="FAF_1904",t))(I||{});class A extends Error{code;severity;userMessage;technicalDetails;recoveryStrategy;recoveryActions;context;timestamp;constructor(e,r,n={}){super(r,{cause:n.cause}),this.name="FAFError",this.code=e,this.timestamp=Date.now();const s=Ue.getErrorInfo(e);this.severity=s.severity,this.recoveryStrategy=s.recoveryStrategy,this.recoveryActions=s.recoveryActions,this.userMessage=n.userMessage||s.userMessage,this.technicalDetails=n.technicalDetails,this.context={timestamp:this.timestamp,platform:n.context?.platform,url:n.context?.url||(typeof window<"u"?window.location.href:void 0),userAgent:n.context?.userAgent||(typeof navigator<"u"?navigator.userAgent:void 0),sessionId:n.context?.sessionId},this.trackError()}static fromUnknown(e,r){if(e instanceof A)return e;if(e instanceof Error){let s="FAF_1901";return e.message.includes("timeout")?s="FAF_1101":e.message.includes("permission")?s="FAF_1204":e.message.includes("DOM")||e.message.includes("document")?s="FAF_1004":e.message.includes("quota")&&(s="FAF_1202"),new A(s,e.message,{cause:e,technicalDetails:e.stack,context:r})}const n=typeof e=="string"?e:String(e);return new A("FAF_1901",n,{context:r})}isRecoverable(){return this.recoveryStrategy!=="none"}requiresUserAction(){return this.recoveryStrategy==="user"}getDisplayInfo(){return{title:this.getErrorTitle(),message:this.userMessage,actions:this.recoveryActions,severity:this.severity,canRetry:this.recoveryStrategy==="retry"}}toJSON(){return{code:this.code,severity:this.severity,message:this.message,userMessage:this.userMessage,technicalDetails:this.technicalDetails,recoveryStrategy:this.recoveryStrategy,recoveryActions:this.recoveryActions,context:this.context,timestamp:this.timestamp,stack:this.stack}}getErrorTitle(){return{low:"Minor Issue",medium:"Issue Detected",high:"Extraction Problem",critical:"Critical Error"}[this.severity]}trackError(){try{console.warn(`[FAF Error ${this.code}] ${this.severity}: ${this.message}`)}catch{}}}class Ue{static errorDefinitions=new Map([["FAF_1001",{code:"FAF_1001",severity:"medium",message:"Platform detection timed out",userMessage:"Unable to detect the current platform quickly enough. The page may be loading slowly.",recoveryStrategy:"retry",recoveryActions:["Wait for page to load completely","Refresh the page","Try extraction again"]}],["FAF_1003",{code:"FAF_1003",severity:"medium",message:"Platform is not supported",userMessage:"This website is not currently supported by FAF. We support GitHub, Monaco Editor, CodeMirror, and other development platforms.",recoveryStrategy:"degrade",recoveryActions:["Try on a supported platform","Copy code manually","Request platform support"]}],["FAF_1004",{code:"FAF_1004",severity:"high",message:"DOM access denied",userMessage:"Cannot access page content due to security restrictions. This may be due to strict Content Security Policy.",recoveryStrategy:"user",recoveryActions:["Refresh the page","Check browser security settings","Try on a different page"]}],["FAF_1101",{code:"FAF_1101",severity:"medium",message:"Context extraction timed out",userMessage:"Extraction took longer than expected. The page may have complex content or be loading slowly.",recoveryStrategy:"retry",recoveryActions:["Wait a moment and try again","Refresh the page","Check internet connection"]}],["FAF_1104",{code:"FAF_1104",severity:"high",message:"Permission denied for extraction",userMessage:"FAF does not have permission to access this page. Please check extension permissions.",recoveryStrategy:"user",recoveryActions:["Check extension permissions in browser settings","Reload the extension","Refresh the page"]}],["FAF_1201",{code:"FAF_1201",severity:"high",message:"Chrome tab access denied",userMessage:"Cannot access the current tab. Please ensure FAF has the necessary permissions.",recoveryStrategy:"user",recoveryActions:["Grant tab permissions to FAF","Reload the extension","Check browser security settings"]}],["FAF_1202",{code:"FAF_1202",severity:"medium",message:"Chrome storage quota exceeded",userMessage:"Extension storage is full. Some data may not be saved.",recoveryStrategy:"fallback",recoveryActions:["Clear extension data","Restart browser","Continue without saving preferences"]}],["FAF_1204",{code:"FAF_1204",severity:"critical",message:"Required Chrome permissions missing",userMessage:"FAF is missing required permissions to function properly.",recoveryStrategy:"user",recoveryActions:["Go to chrome://extensions/","Find FAF extension","Grant required permissions"]}],["FAF_1206",{code:"FAF_1206",severity:"medium",message:"No active tab found",userMessage:"No active tab detected. Please open a supported page.",recoveryStrategy:"user",recoveryActions:["Open a supported website","Refresh the current page","Try a different tab"]}],["FAF_1207",{code:"FAF_1207",severity:"high",message:"Chrome API unavailable",userMessage:"Chrome extension APIs are not available.",recoveryStrategy:"restart",recoveryActions:["Restart browser","Check Chrome version","Reinstall extension"]}],["FAF_1208",{code:"FAF_1208",severity:"medium",message:"Chrome message failed",userMessage:"Failed to communicate with the page. Please try again.",recoveryStrategy:"retry",recoveryActions:["Try again","Refresh the page","Check page permissions"]}],["FAF_1209",{code:"FAF_1209",severity:"high",message:"Script injection failed",userMessage:"Unable to inject required scripts into the page.",recoveryStrategy:"fallback",recoveryActions:["Refresh the page","Try a different page","Check site permissions"]}],["FAF_1210",{code:"FAF_1210",severity:"medium",message:"Chrome storage error",userMessage:"Unable to save data. Some features may not persist.",recoveryStrategy:"degrade",recoveryActions:["Continue without saving","Clear extension data","Restart browser"]}],["FAF_1301",{code:"FAF_1301",severity:"critical",message:"Service worker initialization failed",userMessage:"Extension background service failed to start. Please restart the browser.",recoveryStrategy:"restart",recoveryActions:["Restart browser","Reload extension","Check for browser updates"]}],["FAF_1303",{code:"FAF_1303",severity:"medium",message:"Service worker under memory pressure",userMessage:"Extension is using high memory. Performance may be affected.",recoveryStrategy:"degrade",recoveryActions:["Close unused tabs","Restart browser","Limit concurrent extractions"]}],["FAF_1501",{code:"FAF_1501",severity:"medium",message:"Clipboard permission denied",userMessage:"Cannot copy to clipboard automatically. You can copy the content manually.",recoveryStrategy:"fallback",recoveryActions:["Grant clipboard permission","Copy content manually","Use Ctrl+C to copy"]}],["FAF_1503",{code:"FAF_1503",severity:"low",message:"Clipboard data too large",userMessage:"The extracted content is too large for clipboard. Consider extracting smaller sections.",recoveryStrategy:"degrade",recoveryActions:["Extract smaller code sections","Copy parts manually","Save to file instead"]}],["FAF_1703",{code:"FAF_1703",severity:"high",message:"Content Security Policy violation",userMessage:"Page security settings prevent FAF from working. This is common on some secure sites.",recoveryStrategy:"degrade",recoveryActions:["Try on a different page","Use manual copy instead","Contact site administrator"]}],["FAF_1901",{code:"FAF_1901",severity:"medium",message:"An unexpected error occurred",userMessage:"Something unexpected happened. Please try again or restart the browser.",recoveryStrategy:"retry",recoveryActions:["Try the action again","Refresh the page","Restart browser if issues persist"]}]]);static getErrorInfo(e){const r=this.errorDefinitions.get(e);return r||{code:e,severity:"medium",message:"Unknown error",userMessage:"An unknown error occurred. Please try again.",recoveryStrategy:"retry",recoveryActions:["Try again","Restart extension"]}}static getAllErrorCodes(){return Array.from(this.errorDefinitions.keys())}}class Be{static async getActive(){return new Promise((e,r)=>{try{chrome.tabs.query({active:!0,currentWindow:!0},n=>{if(chrome.runtime.lastError){r(new A(I.CHROME_RUNTIME_ERROR,chrome.runtime.lastError.message||"Unknown runtime error",{technicalDetails:"Chrome tabs API operation failed"}));return}const s=n[0];if(!s?.id||!s.url){r(new A(I.CHROME_TAB_NOT_FOUND,"No active tab found",{technicalDetails:"Chrome tabs API operation failed"}));return}e({id:s.id,url:s.url,title:s.title??"",active:s.active})})}catch(n){r(new A(I.CHROME_API_UNAVAILABLE,n instanceof Error?n.message:"Unknown tabs API error",{technicalDetails:"Chrome API operation failed"}))}})}static async sendMessage(e,r){return new Promise(n=>{try{chrome.tabs.sendMessage(e,r,s=>{if(chrome.runtime.lastError){console.warn("FAF: Tab messaging warning (non-blocking):",chrome.runtime.lastError.message),n();return}n()})}catch(s){console.warn("FAF: Tab messaging warning (non-blocking):",s),n()}})}static async executeScript(e,r){return new Promise(n=>{try{chrome.scripting.executeScript({target:{tabId:e},files:[...r]},()=>{if(chrome.runtime.lastError){console.warn("FAF: Script execution warning (non-blocking):",chrome.runtime.lastError.message),n();return}n()})}catch(s){console.warn("FAF: Script execution warning (non-blocking):",s),n()}})}}class le{static async get(e){return new Promise((r,n)=>{try{chrome.storage.local.get([...e],s=>{if(chrome.runtime.lastError){n(new A(I.CHROME_STORAGE_ERROR,chrome.runtime.lastError.message||"Unknown storage error",{technicalDetails:"Chrome API operation failed"}));return}r(s)})}catch(s){n(new A(I.CHROME_API_UNAVAILABLE,s instanceof Error?s.message:"Unknown storage error",{technicalDetails:"Chrome API operation failed"}))}})}static async set(e){return new Promise((r,n)=>{try{chrome.storage.local.set(e,()=>{if(chrome.runtime.lastError){n(new A(I.CHROME_STORAGE_QUOTA_EXCEEDED,chrome.runtime.lastError.message||"Unknown storage error",{technicalDetails:"Chrome API operation failed"}));return}r()})}catch(s){n(new A(I.CHROME_API_UNAVAILABLE,s instanceof Error?s.message:"Unknown storage error",{technicalDetails:"Chrome API operation failed"}))}})}static async clear(){return new Promise((e,r)=>{try{chrome.storage.local.clear(()=>{if(chrome.runtime.lastError){r(new A(I.CHROME_STORAGE_ERROR,chrome.runtime.lastError.message||"Unknown storage error",{technicalDetails:"Chrome API operation failed"}));return}e()})}catch(n){r(new A(I.CHROME_API_UNAVAILABLE,n instanceof Error?n.message:"Unknown storage error",{technicalDetails:"Chrome API operation failed"}))}})}}class He{config;sessionId;breadcrumbs=[];performanceBuffer=[];userId;constructor(e){this.config=e,this.sessionId=this.generateSessionId(),this.initializeErrorHandling(),this.initializePerformanceTracking(),this.startPerformanceReporting()}generateSessionId(){return`session_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}initializeErrorHandling(){this.config.enableErrorReporting&&typeof window<"u"&&(window.addEventListener("error",e=>{this.reportError(new Error(e.message),{action:"global_error",url:e.filename,line:e.lineno,column:e.colno})}),window.addEventListener("unhandledrejection",e=>{this.reportError(new Error(`Unhandled Promise Rejection: ${e.reason}`),{action:"unhandled_promise_rejection"})}))}initializePerformanceTracking(){this.config.enablePerformanceTracking&&(typeof window<"u"&&typeof performance<"u"&&performance.timing&&window.addEventListener("load",()=>{setTimeout(()=>{this.trackPerformanceMetrics()},1e3)}),this.trackExtensionMetrics())}trackExtensionMetrics(){if(chrome?.runtime){const e=performance.now();chrome.runtime.connect({name:"telemetry"});const r=performance.now()-e;this.recordMetric({name:"service_worker_connection_time",value:r,unit:"ms",timestamp:Date.now()})}if(typeof document<"u"&&document.readyState==="loading"){const e=performance.now();document.addEventListener("DOMContentLoaded",()=>{const r=performance.now()-e;this.recordMetric({name:"content_script_injection_time",value:r,unit:"ms",timestamp:Date.now()})})}}trackPerformanceMetrics(){const e=performance.timing,r=performance.navigation;if([{name:"dom_content_loaded",value:e.domContentLoadedEventEnd-e.navigationStart,unit:"ms"},{name:"page_load_complete",value:e.loadEventEnd-e.navigationStart,unit:"ms"},{name:"dns_lookup_time",value:e.domainLookupEnd-e.domainLookupStart,unit:"ms"},{name:"tcp_connection_time",value:e.connectEnd-e.connectStart,unit:"ms"}].forEach(s=>{s.value>0&&this.recordMetric({...s,timestamp:Date.now(),metadata:{navigationType:r.type,redirectCount:r.redirectCount}})}),performance.memory){const s=performance.memory;this.recordMetric({name:"memory_used",value:s.usedJSHeapSize,unit:"bytes",timestamp:Date.now()}),this.recordMetric({name:"memory_limit",value:s.jsHeapSizeLimit,unit:"bytes",timestamp:Date.now()})}}startPerformanceReporting(){setInterval(()=>{this.performanceBuffer.length>0&&this.flushPerformanceMetrics()},3e4)}async recordMetric(e){if(this.config.enablePerformanceTracking&&!(Math.random()>this.config.sampleRate)){this.performanceBuffer.push(e);try{const n=(await chrome.storage.local.get("telemetry_metrics")).telemetry_metrics||[];n.push(e),n.length>100&&n.shift(),await chrome.storage.local.set({telemetry_metrics:n})}catch(r){console.warn("Failed to store telemetry metric:",r)}}}async reportError(e,r={}){if(!this.config.enableErrorReporting)return;const n={error:{name:e.name,message:e.message,stack:e.stack||""},context:{userAgent:navigator.userAgent,timestamp:Date.now(),sessionId:this.sessionId,userId:this.userId,extensionVersion:this.getExtensionVersion(),...r},stackTrace:e.stack||"",breadcrumbs:[...this.breadcrumbs]};try{const c=(await chrome.storage.local.get("telemetry_errors")).telemetry_errors||[];c.push(n),c.length>50&&c.shift(),await chrome.storage.local.set({telemetry_errors:c})}catch(s){console.warn("Failed to store error report:",s)}this.sendErrorReport(n)}async trackUserEvent(e,r={}){if(!this.config.enableUserAnalytics)return;const n={event:e,properties:{...r,extensionVersion:this.getExtensionVersion(),environment:this.config.environment},timestamp:Date.now(),sessionId:this.sessionId,userId:this.userId};try{const c=(await chrome.storage.local.get("telemetry_events")).telemetry_events||[];c.push(n),c.length>200&&c.shift(),await chrome.storage.local.set({telemetry_events:c})}catch(s){console.warn("Failed to store user event:",s)}this.sendUserEvent(n)}async trackExtraction(e,r={}){return this.trackUserEvent(`extraction_${e}`,r)}async track(e,r={}){return this.trackUserEvent(e,r)}addBreadcrumb(e){const r=`${new Date().toISOString()}: ${e}`;this.breadcrumbs.push(r),this.breadcrumbs.length>20&&this.breadcrumbs.shift()}setUserId(e){this.userId=e}async flushPerformanceMetrics(){if(this.performanceBuffer.length===0)return;const e=[...this.performanceBuffer];this.performanceBuffer=[];try{await this.sendBatch("metrics",e)}catch(r){console.warn("Failed to send performance metrics:",r),this.performanceBuffer.unshift(...e)}}async sendErrorReport(e){try{await this.sendBatch("errors",[e])}catch(r){console.warn("Failed to send error report:",r)}}async sendUserEvent(e){try{await this.sendBatch("events",[e])}catch(r){console.warn("Failed to send user event:",r)}}async sendBatch(e,r){if(!this.config.endpoint)return;const n={type:e,data:r,timestamp:Date.now(),sessionId:this.sessionId,userId:this.userId,environment:this.config.environment},s=await fetch(`${this.config.endpoint}/${e}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});if(!s.ok)throw new Error(`HTTP ${s.status}: ${s.statusText}`)}getExtensionVersion(){try{return chrome.runtime.getManifest().version}catch{return"unknown"}}startTimer(e){const r=performance.now();return()=>{const n=performance.now()-r;this.recordMetric({name:e,value:n,unit:"ms",timestamp:Date.now()})}}trackMemoryUsage(e){if(performance.memory){const r=performance.memory;this.recordMetric({name:"memory_usage_snapshot",value:r.usedJSHeapSize,unit:"bytes",timestamp:Date.now(),metadata:{context:e}})}}trackNetworkRequest(e,r,n,s){this.recordMetric({name:"network_request",value:n,unit:"ms",timestamp:Date.now(),metadata:{url:e.replace(/[?#].*/,""),method:r,status:s,success:s>=200&&s<400}})}}const V=(()=>{const t=typeof process<"u"&&process.env?.NODE_ENV||"production",e=typeof process<"u"&&process.env?.TELEMETRY_ENDPOINT||void 0,r=t==="development",n=t==="production",s={environment:r?"development":n?"production":"staging",enableErrorReporting:n,enablePerformanceTracking:!0,enableUserAnalytics:n,sampleRate:r?1:.1,endpoint:e};return new He(s)})();class O extends Error{constructor(e,r){super(e),this.code=r,this.name="ClipboardError"}}class Ve{static async copyFAFContent(e){const r=this.formatFAFContent(e);await this.writeToClipboard(r)}static async writeToClipboard(e){try{if(navigator.clipboard&&navigator.clipboard.writeText){await navigator.clipboard.writeText(e);return}this.execCommandFallback(e)}catch(r){throw r instanceof Error&&r.name==="NotAllowedError"?new O("Clipboard access denied","PERMISSION_DENIED"):new O(r instanceof Error?r.message:"Failed to write to clipboard","WRITE_FAILED")}}static execCommandFallback(e){const r=document.createElement("textarea");try{if(r.value=e,r.style.position="fixed",r.style.left="-9999px",r.style.top="-9999px",r.style.opacity="0",r.setAttribute("readonly",""),document.body.appendChild(r),r.select(),r.setSelectionRange(0,e.length),!document.execCommand("copy"))throw new O("execCommand copy failed","WRITE_FAILED")}finally{r.parentNode&&r.parentNode.removeChild(r)}}static formatFAFContent(e){const r=e.score,n=this.getConfidenceMessage(r);return`.faf Context
URL: ${e.context.metadata.url}
Platform: ${e.context.platform}
Score: ${r}%
Extracted: ${e.generated}

Detection
Code blocks found: ${this.getCodeBlockCount(e)}
Package.json detected: ${this.hasPackageJson(e)}
Environment vars: ${this.hasEnvironmentVars(e)}

AI Instructions
Context extracted from ${e.context.platform} with ${r}% confidence.
${n}

## Summary
${e.summary}

## Project Structure
Files: ${e.context.structure.totalFiles}
Lines: ${e.context.structure.totalLines}
Entry Points: ${e.context.structure.entryPoints.join(", ")||"None detected"}

## Dependencies
Runtime: ${e.context.dependencies.runtime.language} ${e.context.dependencies.runtime.version}
Package Manager: ${e.context.dependencies.runtime.packageManager}
Packages: ${e.context.dependencies.packages.length}

## Raw Context
${JSON.stringify(e.context,null,2)}`}static getConfidenceMessage(e){return e>=80?"High confidence - Full project context available with complete file structure and dependencies.":e>=50?"Medium confidence - Partial context available with basic project information.":"Low confidence - Limited context available, basic page analysis only."}static getCodeBlockCount(e){return e.context.structure.files.length>0?e.context.structure.files.length:0}static hasPackageJson(e){return e.context.dependencies.packages.length>0||e.context.structure.files.some(r=>r.path.includes("package.json"))}static hasEnvironmentVars(e){return e.context.environment.variables.length>0||e.context.environment.configFiles.some(r=>r.includes(".env"))}static validateFAFContent(e){if(!e.version)throw new O("Invalid FAF file: missing version","FORMAT_ERROR");if(!e.context)throw new O("Invalid FAF file: missing context","FORMAT_ERROR");if(!e.context.metadata?.url)throw new O("Invalid FAF file: missing URL","FORMAT_ERROR");const r=e.score;if(!Number.isInteger(r)||r<0||r>100)throw new O("Invalid FAF file: invalid score","FORMAT_ERROR")}static getContentPreview(e){const r=this.formatFAFContent(e);return r.length>200?`${r.substring(0,200)}...`:r}}function ue(t,e,r){const n=t.slice();return n[5]=e[r],n}function me(t){let e,r,n,s,c;return{c(){e=d("div"),r=d("span"),r.textContent="‚ö†Ô∏è",n=y(),s=d("span"),c=v(t[2]),g(e,"class","error svelte-rlu0ai")},m(l,u){T(l,e,u),a(e,r),a(e,n),a(e,s),a(s,c)},p(l,u){u&4&&S(c,l[2])},d(l){l&&F(e)}}}function Ge(t){let e;return{c(){e=d("div"),e.innerHTML='<div class="empty-icon svelte-rlu0ai">üìÑ</div> <p class="svelte-rlu0ai">Ready to extract context</p> <p class="hint svelte-rlu0ai">Click extract to analyze the current page</p>',g(e,"class","empty-state svelte-rlu0ai")},m(r,n){T(r,e,n)},p:P,d(r){r&&F(e)}}}function je(t){let e,r,n,s=t[0].faf.score.total+"",c,l,u,i,o,m,_,f=t[0].faf.metadata.platform+"",k,b,p,L,x,w=t[0].faf.files.length+"",h,C,U,J,ye,W=pe(t[0].faf.files)+"",Y,ve,Q,G,Z,Ee,E=t[0].faf.files.length>0&&de(t);return{c(){e=d("div"),r=d("div"),n=d("div"),c=v(s),l=v("%"),u=y(),i=d("div"),o=d("div"),m=d("strong"),m.textContent="Platform:",_=y(),k=v(f),b=y(),p=d("div"),L=d("strong"),L.textContent="Files:",x=y(),h=v(w),C=y(),U=d("div"),J=d("strong"),J.textContent="Size:",ye=y(),Y=v(W),ve=y(),E&&E.c(),Q=y(),G=d("button"),G.textContent="Copy FAF to Clipboard",g(n,"class","score-badge svelte-rlu0ai"),se(n,"background",ge(t[0].faf.score.total)),g(o,"class","svelte-rlu0ai"),g(p,"class","svelte-rlu0ai"),g(U,"class","svelte-rlu0ai"),g(i,"class","details svelte-rlu0ai"),g(r,"class","score-section svelte-rlu0ai"),g(G,"class","copy-button svelte-rlu0ai"),g(e,"class","result svelte-rlu0ai")},m(R,M){T(R,e,M),a(e,r),a(r,n),a(n,c),a(n,l),a(r,u),a(r,i),a(i,o),a(o,m),a(o,_),a(o,k),a(i,b),a(i,p),a(p,L),a(p,x),a(p,h),a(i,C),a(i,U),a(U,J),a(U,ye),a(U,Y),a(e,ve),E&&E.m(e,null),a(e,Q),a(e,G),Z||(Ee=ne(G,"click",t[4]),Z=!0)},p(R,M){M&1&&s!==(s=R[0].faf.score.total+"")&&S(c,s),M&1&&se(n,"background",ge(R[0].faf.score.total)),M&1&&f!==(f=R[0].faf.metadata.platform+"")&&S(k,f),M&1&&w!==(w=R[0].faf.files.length+"")&&S(h,w),M&1&&W!==(W=pe(R[0].faf.files)+"")&&S(Y,W),R[0].faf.files.length>0?E?E.p(R,M):(E=de(R),E.c(),E.m(e,Q)):E&&(E.d(1),E=null)},d(R){R&&F(e),E&&E.d(),Z=!1,Ee()}}}function de(t){let e,r,n,s,c=ce(t[0].faf.files.slice(0,3)),l=[];for(let i=0;i<c.length;i+=1)l[i]=fe(ue(t,c,i));let u=t[0].faf.files.length>3&&he(t);return{c(){e=d("div"),r=d("div"),r.textContent="Files extracted:",n=y();for(let i=0;i<l.length;i+=1)l[i].c();s=y(),u&&u.c(),g(r,"class","files-header svelte-rlu0ai"),g(e,"class","files-preview svelte-rlu0ai")},m(i,o){T(i,e,o),a(e,r),a(e,n);for(let m=0;m<l.length;m+=1)l[m]&&l[m].m(e,null);a(e,s),u&&u.m(e,null)},p(i,o){if(o&1){c=ce(i[0].faf.files.slice(0,3));let m;for(m=0;m<c.length;m+=1){const _=ue(i,c,m);l[m]?l[m].p(_,o):(l[m]=fe(_),l[m].c(),l[m].m(e,s))}for(;m<l.length;m+=1)l[m].d(1);l.length=c.length}i[0].faf.files.length>3?u?u.p(i,o):(u=he(i),u.c(),u.m(e,null)):u&&(u.d(1),u=null)},d(i){i&&F(e),Fe(l,i),u&&u.d()}}}function fe(t){let e,r,n=t[5].path+"",s,c,l,u=X(t[5].content.length)+"",i;return{c(){e=d("div"),r=d("span"),s=v(n),c=y(),l=d("span"),i=v(u),g(r,"class","file-path svelte-rlu0ai"),g(l,"class","file-size svelte-rlu0ai"),g(e,"class","file-item svelte-rlu0ai")},m(o,m){T(o,e,m),a(e,r),a(r,s),a(e,c),a(e,l),a(l,i)},p(o,m){m&1&&n!==(n=o[5].path+"")&&S(s,n),m&1&&u!==(u=X(o[5].content.length)+"")&&S(i,u)},d(o){o&&F(e)}}}function he(t){let e,r,n=t[0].faf.files.length-3+"",s,c;return{c(){e=d("div"),r=v("+"),s=v(n),c=v(" more files"),g(e,"class","more-files svelte-rlu0ai")},m(l,u){T(l,e,u),a(e,r),a(e,s),a(e,c)},p(l,u){u&1&&n!==(n=l[0].faf.files.length-3+"")&&S(s,n)},d(l){l&&F(e)}}}function We(t){let e,r;return{c(){e=d("span"),e.textContent="‚ö°",r=v(`
        Extract Context`)},m(n,s){T(n,e,s),T(n,r,s)},d(n){n&&(F(e),F(r))}}}function ze(t){let e,r;return{c(){e=d("span"),e.textContent="‚ü≥",r=v(`
        Extracting...`),g(e,"class","spinner svelte-rlu0ai")},m(n,s){T(n,e,s),T(n,r,s)},d(n){n&&(F(e),F(r))}}}function qe(t){let e,r,n,s,c,l,u,i,o,m,_,f=t[2]&&me(t);function k(h,C){if(h[0]?.success)return je;if(!h[1])return Ge}let b=k(t),p=b&&b(t);function L(h,C){return h[1]?ze:We}let x=L(t),w=x(t);return{c(){e=d("div"),r=d("header"),r.innerHTML='<div class="logo svelte-rlu0ai"><span>‚ö°</span> <h1 class="svelte-rlu0ai">FAF - Fast AF</h1></div> <div class="tagline svelte-rlu0ai">Extract perfect AI context in 0.3s</div>',n=y(),s=d("main"),f&&f.c(),c=y(),p&&p.c(),l=y(),u=d("button"),w.c(),i=y(),o=d("footer"),o.innerHTML="<span>v1.0.0 ‚Ä¢ Svelte-powered</span>",g(r,"class","svelte-rlu0ai"),g(u,"class","extract-button svelte-rlu0ai"),u.disabled=t[1],g(o,"class","svelte-rlu0ai"),g(e,"class","popup svelte-rlu0ai")},m(h,C){T(h,e,C),a(e,r),a(e,n),a(e,s),f&&f.m(s,null),a(s,c),p&&p.m(s,null),a(s,l),a(s,u),w.m(u,null),a(e,i),a(e,o),m||(_=ne(u,"click",t[3]),m=!0)},p(h,[C]){h[2]?f?f.p(h,C):(f=me(h),f.c(),f.m(s,c)):f&&(f.d(1),f=null),b===(b=k(h))&&p?p.p(h,C):(p&&p.d(1),p=b&&b(h),p&&(p.c(),p.m(s,l))),x!==(x=L(h))&&(w.d(1),w=x(h),w&&(w.c(),w.m(u,null))),C&2&&(u.disabled=h[1])},i:P,o:P,d(h){h&&F(e),f&&f.d(),p&&p.d(),w.d(),m=!1,_()}}}function ge(t){return t>=90?"#10b981":t>=70?"#3b82f6":t>=50?"#f59e0b":"#ef4444"}function X(t){return t<1024?`${t}B`:t<1048576?`${(t/1024).toFixed(1)}KB`:`${(t/1048576).toFixed(1)}MB`}function pe(t){const e=t.reduce((r,n)=>r+n.content.length,0);return X(e)}function Ke(t,e,r){let n=null,s=!1,c=null;Te(async()=>{console.log("FAF Popup mounted with Svelte!");try{await V.track("user_action",{action:"popup_opened",timestamp:Date.now()});const i=await le.get(["lastExtraction"]);i.lastExtraction&&r(0,n=i.lastExtraction)}catch(i){console.warn("Failed to load stored data:",i)}});async function l(){if(!s){r(1,s=!0),r(2,c=null);try{await V.track("user_action",{action:"extract_clicked",timestamp:Date.now()});const i=await Be.getActive();if(!i?.id)throw new Error("No active tab found");console.log("Sending message to content script on tab:",i.id);const o=await chrome.tabs.sendMessage(i.id,{type:"EXTRACT_CONTEXT",timestamp:Date.now(),source:"popup"});if(console.log("Got response:",o),o?.success)r(0,n=o),await le.set({lastExtraction:o}),await V.track("extraction_complete",{platform:o.faf.metadata.platform,score:o.faf.score.total,fileCount:o.faf.files.length});else throw new Error(o?.error||"Extraction failed - no response from content script")}catch(i){const o=i instanceof Error?i.message:"Failed to extract context";r(2,c=o),console.error("Extraction error:",i),await V.track("extraction_error",{error:o,phase:"popup_extract"})}finally{r(1,s=!1)}}}async function u(){if(n?.success)try{await Ve.copyFAFContent(n.faf),await V.track("user_action",{action:"copy_to_clipboard",score:n.faf.score});const i=document.querySelector(".copy-button");if(i){const o=i.textContent;i.textContent="‚úì Copied!",setTimeout(()=>{i.textContent=o},2e3)}}catch{r(2,c="Failed to copy to clipboard")}}return[n,s,c,l,u]}class Xe extends $e{constructor(e){super(),Ne(this,e,Ke,qe,Ae,{})}}const _e=document.getElementById("app");if(!_e)throw new Error("App container not found");return new Xe({target:_e,props:{}})}();
